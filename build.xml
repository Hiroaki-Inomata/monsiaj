<?xml version="1.0" encoding="us-ascii"?>
<!-- $Id: build.xml,v 1.16 2004-04-06 13:05:27 ozawa Exp $ -->
<project name="panda-client" default="dist" basedir=".">

  <!-- properties -->

  <property name="compile.debug"       value="yes"/>
  <property name="compile.deprecation" value="yes"/>
  <property name="compile.verbose"     value="no"/>
  <property name="clean.verbose"       value="no"/>

  <property name="src.dir"             value="src"/>
  <property name="build.dir"           value="bin"/>
  <property name="tmp.dir"             value="tmp"/>
  <property name="dist.dir"            value="dist"/>
  <property name="resources.dir"       value="resources"/>
  <property name="libs.dir"            value="libs"/>

  <property name="webstart.url"        value="http://localhost/java-client/"/>

  <path id="project.class.path">
    <pathelement path="libs/*.jar"/>
  </path>

  <!-- targets -->

  <target name="prepare"
          description="Sets the timestamp and creates directories">
    <tstamp/>
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${tmp.dir}"/>
    <mkdir dir="${dist.dir}"/>
    <condition property="exclude.j2selogger" value="**/J2SELogger.java">
      <not>
        <available classname="java.util.logging.Logger"/>
      </not>
    </condition>
    <condition property="exclude.log4jlogger" value="**/Log4JLogger.java">
      <not>
        <available classname="org.apache.log4j.Logger"/>
      </not>
    </condition>
    <condition property="exclude.ssl" value="**/SSLSocketCreator.java">
      <not>
        <available classname="javax.net.ssl.SSLSocket"/>
      </not>
    </condition>
    <condition property="exclude.prefs" value="**/PreferenceBasedConfiguration.java">
      <not>
        <available classname="java.util.prefs.Preferences"/>
      </not>
    </condition>
  </target> 

  <target name="compile" depends="prepare"
    description="Compiles all Java sources.">
    <javac srcdir="${src.dir}"
           destdir="${build.dir}"
           verbose="${compile.verbose}"
	   deprecation="${compile.deprecation}" 
           debug="${compile.debug}">
      <include name="**/*.java"/>
      <exclude name="${exclude.j2selogger}"/>
      <exclude name="${exclude.log4jlogger}"/>
      <exclude name="${exclude.ssl}"/>
      <exclude name="${exclude.prefs}"/>
      <classpath refid="project.class.path"/>
    </javac>
  </target>

  <target name="resources" depends="prepare">
    <copy todir="${build.dir}">
      <fileset dir="${src.dir}" includes="**/*.properties"/>
      <fileset dir="${resources.dir}" includes="*.jpg"/>
    </copy>
    <native2ascii src="${resources.dir}" dest="${build.dir}"
      includes="*.jnlp" encoding="EUC-JP"/>
    <filter token="webstarturl" value="${webstart.url}"/>
    <copy todir="${tmp.dir}" filtering="true">
      <fileset dir="${build.dir}" includes="*.jnlp"/>
    </copy>
    <delete verbose="${clean.verbose}" quiet="true">
      <fileset dir="${build.dir}" includes="*.jnlp"/>
    </delete>
    <native2ascii src="${tmp.dir}" dest="${build.dir}"
      includes="*.jnlp" encoding="UTF-8" reverse="true"/>
  </target>

  <target name="dist" depends="compile,resources"
          description="Build files to be distributed.">
    <!-- ant 1.5.x should use destfile instead of jarfile-->
    <jar jarfile="${dist.dir}/pandaclient.jar"
         basedir="${build.dir}"
         includes="org/montsuqi/**/*.class,org/montsuqi/**/*.properties"
         manifest="${resources.dir}/manifest.mf"/>
    <jar jarfile="${dist.dir}/jmareceipt.jar"
         basedir="${build.dir}"
         includes="jp/or/med/jma_receipt/**/*.class,jp/or/med/jma_receipt/**/*.properties,*.jpg"
         manifest="${resources.dir}/jmareceipt.mf"/>
    <!-- ant 1.5.x should use destfile instead of zipfile-->
    <copy todir="${dist.dir}">
      <fileset dir="${libs.dir}" includes="*.jar"/>
    </copy>
    <copy todir="${dist.dir}">
      <fileset dir="${build.dir}" includes="*.jnlp"/>
    </copy>
    <zip zipfile="${dist.dir}/monsiaj-${DSTAMP}.zip">
      <fileset dir="${dist.dir}" includes="*.jar"/>
    </zip>
  </target>

  <target name="buildclean"
          description="Cleans all built files.">
    <delete verbose="${clean.verbose}" quiet="true">
      <fileset dir="${build.dir}"/>
    </delete>
  </target>

  <target name="clean"
          description="Cleans temporary files and outputs.">
    <delete verbose="${clean.verbose}" quiet="true">
      <fileset dir="." defaultexcludes="no" includes="**/*~,**/.#*#"/>
    </delete>
  </target>

  <target name="veryclean" depends="clean,buildclean"
    description="Cleans all generated files.">
    <delete dir="${build.dir}" verbose="${clean.verbose}" quiet="true"/>
    <delete dir="${dist.dir}"  verbose="${clean.verbose}" quiet="true"/>
  </target>

  <target name="jars"
    description="*obsolete* Deploy jars.">
    <echo message="Taret 'jars' is obsolete. Use 'dist' instead."/>
    <antcall target="dist"/>
  </target>

</project>
