!目次

*配布物の内容
*ランチャーの起動方法
*設定項目について
*システムプロパティについて
*スタイルファイルについて
*プロキシについて

!配布物の内容

3種類の配布物があります。

*バイナリ配布物 monsiaj-bin-YYYYMMDD.zip
*バイナリ配布物(MacOS X アプリケーションバンドル版) monsiaj-bin-macos-YYYYMMDD.zip
*ソース配布物 monsiaj-src-YYYYMMDD.zip

YYYYMMDDは配布物作成の年月日を表します。

!!バイナリ配布物の内容

:README.txt, README.html:説明書(実行には不要です)
:jmareceipt.jar:日レセ専用ランチャー
:pandaclient.jar:Javaクライアント本体(汎用ランチャーを含みます)
:libs/WebKit.jar, libwebkitsample.jnilib, libwebkitsample.jnilib.jar:MacOS Xで使用されるHTML表示モジュール(MacOS X以外では不要です)
:libs/log4j.jar:ログ出力モジュール(なくても実行可能です)
:libs/nimrodlf.jar:Nimrodルックアンドフィールモジュール
:libs/BareBonesBrowserLaunch.jar:外部ブラウザ起動ライブラリ
:jma-receipt.jpg:日レセ専用ランチャーアイコンファイル
:jws.jnlp:Java Web Start配備用サンプル設定ファイル(実行には不要です)
:theme/*.theme:Nimrod用テーマファイル

!!バイナリ配布物(MacOS X アプリケーションバンドル版)の内容

:README.txt, README.html:説明書(実行には不要です)
:JMAReceipt.app:日レセアプリケーションバンドル版
:theme/*.theme:Nimrod用テーマファイル

!!ソース配布物の内容

:README.txt, README.html:説明書(実行には不要です)
:HOWTOBUILD.txt:ビルド方法の説明(実行には不要です)
:src/ 以下のファイル:ソースコード
:libs/ 以下のファイル:各種ライブラリ
:resources/:画像や設定ファイルなど各種リソース
:build.xml:antでコンパイルを行うためのビルドファイル

!!ランチャーの起動方法

ファイルマネージャ(エクスプローラ、ファインダなど)から、ランチャー(jmareceipt.jar
またはpandaclient.jar)の置かれているディレクトリ(フォルダ)を開き、ランチャーの
jarファイルをダブルクリックして起動します。

ランチャーには日レセを起動するための専用ランチャーと他のアプリケーションの起動
にも使える汎用のランチャーがあります。

!!!日レセ専用ランチャーを起動する場合
jmareceipt.jar のアイコンをダブルクリック。
!!!汎用ランチャーを起動する場合
pandaclient.jar のアイコンをダブルクリック。

起動の際には、配布されたjarファイルがすべて同一のディレクトリ(フォルダ)にある
必要があります。

ランチャーを起動したら、各種設定を行ってからランチャーの実行ボタンをクリックし、
アプリケーションを実行します。

!!設定項目について

ランチャーで各種設定を行うことが出来ます。
設定項目は3つのタブに分かれています。

!!!基本設定タブ

:ホスト(ポート):接続するホストとポート番号を指定します。通常、ポート番号は 8000 です。
:アプリケーション:実行するアプリケーションを panda:アプリケーション名 の形式で指定します。日レセ専用ランチャーを使用した場合は、panda:orca00 から変更することはできません。
:ユーザー:ユーザー名を入力します。SSLクライアント認証を使用する場合は、入力しても無視されます。
:プロトコルバージョン:通信プロトコルのバージョンを指定します。日レセの場合は、1です。それ以外の場合はアプリケーションごとに異なるので確認が必要です。日レセ専用ランチャーの場合、1から変更することはできません。
:パスワード:パスワードを入力します。入力した文字の代わりに * が表示されます。SSLクライアント認証を使用する場合は、入力しても無視されます。
:パスワードを保存:チェックすると、パスワードをシステムに保存するようになります。暗号化は行わずそのまま保存するので、セキュリティの観点からは推奨されません。チェックを解除すると、今までシステムに保存していたパスワードは削除されます。

!!!SSLタブ

:SSLを使用:通信にSSLを使用する場合、チェックします。
:クライアント証明書:クライアント証明書ファイル(PKCS#12形式)を指定します。クライアント認証を使用しない場合は無視されます。
:証明書パスワード:クライアント証明書のパスワードを入力します。クライアント認証を使用しない場合は無視されます。
:証明書パスワードを保存:チェックすると、証明書パスワードをシステムに保存するようになります。注意点は基本設定タブのパスワードと同様です。

!!!その他の設定タブ

:スタイル:スタイルファイルを指定します。無指定時には内蔵のスタイルファイルが使用されます。
:エンコーディング:画面定義ファイルの文字エンコーディングを指定します。通常は EUC-JP です。日レセ専用ランチャーを使用した場合は EUC-JP から変更することはできません。
:ルック&フィール:画面の外見を指定します。最初に実行した際に、実行環境に合わせたもの(WindowsならWindows風など)が選択されていますが、他の物に変更しても問題ありません。
:ルック&フィールのテーマ:ルック＆フィールのテーマ(配色)を変更します。
:ログビューワの使用:チェックすると、ログ表示ウィンドウがアイコン化された状態で現れます。不具合発生時に利用してください。
:画面の拡大表示:チェックすると、ウィンドウがディスプレイ全体に拡大されます。縦横比はディスプレイにあわせて変化します。フォントのサイズは自動では変化しません。
:タイマーの使用:チェックすると、入力しながら自動的に検索を絞り込む機能が有効になります。
:タイマー起動時間:検索を開始するまでに待機する時間を指定します。単位はミリ秒(1000分の1秒)です。
:追加システムプロパティ:必要に応じて、その他のプロパティを1行に1つの形式で記述します。

!! サーバ設定

ランチャー上部のサーバ選択コンボボックスでサーバ設定名を選択すると、ランチャーの設定を切替えることができます。
2008年6月以前のバージョンの設定はdefaultに引き継がれます。
 
!!! サーバ設定の登録
#ランチャー下部の設定ボタンを押してサーバ設定ダイアログを起動します。
#新規作成ボタンを押して、新規作成ダイアログを起動します。
#各設定項目を設定します。設定は説明の項目を除いてランチャーと同様です。説明の項目は設定名になります。
#設定後、OKボタンを押すと登録完了です。


!!! サーバ設定の変更
#ランチャー下部の設定ボタンを押してサーバ設定ダイアログを起動します。
#リストから変更したい設定を選択して、編集ボタンを押します。
#編集ダイアログで設定項目を変更します。 
#設定後、OKボタンを押すと変更完了です。

!!! サーバ設定の削除
#ランチャー下部の設定ボタンを押してサーバ設定ダイアログを起動します。
#リストから削除したい設定を選択して、削除ボタンを押します。
#確認ダイアログが表示されます。
#OKボタンを押すと削除完了です。

!! システムプロパティについて

ランチャーの「その他の設定」タブにある「追加システムプロパティ」欄に記述することで、
一部の動作をカスタマイズすることが出来ます。

 プロパティ名=設定値
という書式で、1行に1つずつ記述します。

!!!設定できるプロパティ
 
!!!!monsia.user.font
プログラム全体で使用するフォントを指定します。値は「フォント名-書体-サイズ」の形です。

フォントは、プラットフォーム共通のJava論理フォント名
(Serif/SansSerif/Monospaced/Dialog/DialogInput)、
もしくはプラットフォーム固有の物理フォント名を指定します。

書体はPLAIN/BOLD/ITALIC/BOLDITALIC(大文字小文字の区別はなし)のいずれかです。

サイズは整数で単位はポイントです。

例:セリフ付きの18ポイントフォントを使用する。
 monsia.user.font=Serif-PLAIN-18

!!!!monsia.user.font.XXX
特定の画面部品タイプ(ボタンなど)に固有のフォントを指定します。XXXの部分には
以下のものが使用できます。
*button
*togglebutton
*radiobutton
*combobox
*tabbedpane
*label
*textfield
*table

例:ボタンに14ポイント、ラベルに12ポイントのセリフ付きフォントを使用する。
 monsia.user.font.button=Serif-PLAIN-14
 monsia.user.font.label=Serif-PLAIN-12

monsia.user.fontよりも、これらの値の方が優先されます。

!!!!monsia.warn.certificate.expiration.before
クライアント証明書の有効期限切れの警告を行う日数を指定します。
単位は日です。

無指定時は30となっており、有効期限切れの30日前から警告が行われます。

例:有効期限切れの一週間前から警告を表示する。
 monsia.warn.certificate.expiration.before=7

!!!!monsia.logger.factory
ログ出力モジュールを変更します。
デバッグ用です。

!!スタイルファイルについて

スタイルファイルを独自に定義する場合、以下に従ってください。

!!!書式

Javaのプロパティファイルです。
以下のように指定します。

 スタイル名.font=フォント名-書体-サイズ
 スタイル名.fg=色指定
 スタイル名.bg=色指定

フォント名は monsia.user.font プロパティと同様の書式で指定できます。

色指定の値は # 記号に続けて色のRGB値を表す6桁の16進数を記述します。

fgの同義語としてかわりに foreground、
bgの同義語としてかわりに backgroundも使用できます。

!!!エンコーディングについて
Javaのプロパティファイルでは、仕様上、
プラットフォームネイティブな文字エンコーディングを出来ないので、
「ＭＳゴシック」のような非ASCII文字列を含む場合は、native2ascii
を使用して \uxxxx 形式に変換する必要があります。

!! ルック&フィールのテーマについて

ルック&フィールがNimrodの場合に、ルック＆フィールのテーマにテーマファイルを指定することでGUI部品の配色を変更することができます。
テーマファイルはパッケージのthemeフォルダ以下にあります。パッケージに含まれているテーマは以下です。

* LightPastelBlue.theme
* LightPastelRed.theme
* LightTabaco.theme
* Macchya.theme
* Snow.theme
* Sumire.theme

また共通版パッケージに含まれているテーマエディター(nimrodlf.jar)を使用することで、オリジナルテーマファイルを作成できます。

テーマファイル及びテーマエディターの詳細については、以下のURLを参照してください。

* http://personales.ya.com/nimrod/themes-en.html

!! 画面の拡大表示について

画面の拡大表示はその他の設定タブから設定します。

有効にすると画面をディスプレイ全体に拡大表示します。
画面の拡大は常に最大表示となります。拡大比率を任意に指定することはできません。
画面の縦横比はディスプレイに合わせて変化します。そのため解像度 1280 * 800 等のワイドディスプレイでは全体的に横長に表示します。

なおフォントのサイズは自動では変更しません。解像度が1680 * 1024等の大画面ディスプレイの場合フォントサイズを大きくした方が良いでしょう。
フォントサイズの変更はシステムプロパティの説明を参照してください。

!!プロキシについて

Webアクセスにプロキシが必要な環境では、以下の設定を行ってください。

!!!MacOS X以外の場合
「その他の設定」タブの「追加システムプロパティ」欄に以下の2行の内容を記述します。
 http.proxyHost=ホスト名
 http.proxyPort=ポート番号
(注) =の左側では、大文字と小文字は区別されます。

!!!MacOS Xの場合
#アップルメニュー→システム環境設定→ネットワーク を開きます。
#使用しているネットワークを選択します。
#設定...ボタンを押します。
#いちばん右の「プロキシ」タブを選択します。
#「プロキシの設定」で「手入力」を選択します。
#「設定するプロキシサーバを選択」リスト内の、□Webプロキシ (HTTP)にチェックを入れます。
#「Webプロキシサーバ」欄のホストとポートを記入します。

!! コマンドラインオプションについて

コンソールで専用ランチャーまたは汎用ランチャーを起動する際に、コマンドラインオプションを指定出来ます。

!!! ヘルプの表示

  > java -jar jmareceipt.jar -h
  USAGE:jp.or.med.jma_receipt.JMAReceiptLauncher <option(s)> files...
  -config : 指定された設定で接続する
   []
  -config-list : 設定リストを表示する
   [false]

!!! 設定リストの表示

  > java -jar jmareceipt.jar -config-list
  設定リスト
  ------------------
  192.168.1.51
     ホスト:                 192.168.1.51
     ポート:                 8000
     アプリケーション:       panda:orca00
     ユーザ:                 ormaster
  default
     ホスト:                 192.168.1.51
     ポート:                 8000
     アプリケーション:       panda:orca00
     ユーザ:                 ormaster

!!! 設定を指定してサーバへ接続

  > java -jar jmareceipt.jar -config=設定名

設定名に登録してあるサーバ設定を指定します。
パスワードを保存しない設定の場合、パスワード入力ダイアログが表示されます。

!! ショートカットアイコンの作成について

設定を指定するコマンドラインオプションを利用して、特定のサーバに接続するショートカットアイコンを作成することができます。

!!! Windows XP の場合
#monsiaj-bin-YYYYMMDD.zipを展開します。
#jmareceipt.jarのショートカットを作成します。
#ショートカットを右クリックし、ショートカットのプロパティを開きます。
#ショートカットタブのリンク先の末尾に"-config=設定名"を追加します。
#ショーカットをダブルクリックするとサーバに接続します。

!!! MacOS X の場合

!!!! MacOS Xアプリケーションバンドル版を使用する方法(推奨)

#monsiaj-bin-macosx-YYYYMMDD.zipを展開します。
#JMAReceiptアイコンを Controlキーを押しながらクリックしてメニューを表示し、"パッケージの内容を表示"を開きます。
#JMAReceiptフォルダが表示されるので、Contentsフォルダを開きます。
#Info.plistファイルをダブルクリックし編集します。
#<key>Arguments<key> の下行の <string></string> に -config=|設定名| 記述します(下部参照)。
#Info.plist を閉じて、保存します。
#JMAReceiptアイコンをダブルクリックするとサーバに接続します。

     ...
       </array>
        <key>Arguments</key>
        <string>-config=|設定名|</string>
                ^^^^^^^^^^^^^^^^
        <key>Properties</key>
        <dict>
     ...

※ 複数作成する場合は、アプリケーションバンドルの複製を作成して、複製に対して同様の手順を実行します。

!!!! 共通版を使用する方法

#monsiaj-bin-YYYYMMDD.zipを展開します。
#Finderより、アプリケーション->AppleScript->スクリプトエディタを起動します。
#スクリプト入力欄にスクリプトを記述します(下部参照)。
**-jarの後に1文字スペースを空けて|jmareceipt.jarのフルパス|を記述します。
**-config=の後に|設定名|を記述します。
#再生ボタンを押して、一度スクリプトを実行し日レセメイン画面が表示されるかどうか確認します。
#メイン画面が表示されたら日レセを終了します。
#スクリプトエディタのメニューから保存を選択します。
#スクリプト保存のダイアログが表示されるので、以下の設定をして保存します。
**フォーマット -> "アプリケーション"に設定
**実行専用 -> チェックしない
**初期画面 -> チェックしない
**実行後、自動的に終了しない -> チェックしない
#作成したスクリプトのアイコンをダブルクリックするとサーバに接続します。

     do shell script "java -jar |jmareceipt.jarへのフルパス| -config=|設定名|"

!! 既知の問題

!!! Mac OS X環境

* 日本語変換ソフトの自動切り替え機能が動作しない
* 受付業務 患者登録の画面でコメント入力部分の下部が隠れてしまう
* Mac OS Xルック＆フィールにおいて、CLISTのヘッダラベルが完全に表示されない場合がある
